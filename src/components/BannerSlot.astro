---
import { bannerSlots, getBannerSlot, type BannerSlotId } from '../data/banners';
import { buildTrackedLink } from '../utils/links';

interface Props {
  id: BannerSlotId;
  class?: string;
}

const { id, class: className = '' } = Astro.props as Props;
const slot = getBannerSlot(id);

if (!slot) {
  const available = Object.keys(bannerSlots).join(', ');
  throw new Error(`Banner slot "${id}" is not defined. Available slots: ${available}`);
}

const href = buildTrackedLink({
  path: slot.path,
  slot: slot.id,
  camp: slot.camp,
  placeholder: slot.placeholder
});

const resolveHostname = (value: string | undefined) => {
  if (!value) {
    return '';
  }

  try {
    return new URL(value).hostname;
  } catch {
    return String(value).replace(/^https?:\/\//, '').split('/')[0];
  }
};

const siteHostname = resolveHostname(import.meta.env.SITE as string | undefined);
const isPagesBuild = import.meta.env.IS_PAGES === 'true';
const shouldTrackClicks = siteHostname === 'naughtycamspot.com' && !isPagesBuild;

const anchorClass = [
  'banner-slot block overflow-hidden rounded-3xl border border-white/10 bg-white/5 p-3 text-center shadow-glow',
  className
]
  .filter(Boolean)
  .join(' ');
---
<a
  class={anchorClass}
  href={href}
  target="_blank"
  rel="nofollow sponsored"
  data-track={shouldTrackClicks ? 'click' : undefined}
  data-slot={shouldTrackClicks ? slot.id : undefined}
  data-camp={shouldTrackClicks ? slot.camp : undefined}
>
  <img
    src={slot.image}
    alt={slot.alt}
    width={slot.width}
    height={slot.height}
    loading="lazy"
    decoding="async"
    class="h-auto w-full object-cover"
  />
</a>
