---
import { banners, type Banner } from '../data/banners';
import { withBase } from '../utils/links';

interface Props {
  id: Banner['id'];
  class?: string;
  placement?: string;
}

const { id, class: className = '', placement } = Astro.props as Props;

const banner = banners.find((entry) => entry.id === id);

if (!banner) {
  const available = banners.map((entry) => entry.id).join(', ');
  throw new Error(`Banner slot "${id}" is not defined. Available slots: ${available}`);
}

const isPagesBuild = import.meta.env.IS_PAGES === 'true';
const baseUrl = typeof import.meta.env.BASE_URL === 'string' ? import.meta.env.BASE_URL : '/';
const isGoSlug = banner.href.startsWith('/go/');
const safeHref = isPagesBuild && isGoSlug ? '/join-models' : banner.href;
const isAbsoluteHref = /^https?:\/\//i.test(safeHref);
const hasBasePrefix = !isAbsoluteHref && typeof baseUrl === 'string' && baseUrl !== '/' && safeHref.startsWith(baseUrl);
const anchorHref = isAbsoluteHref || hasBasePrefix ? safeHref : withBase(safeHref);
const imgSrc = withBase(banner.img);

const anchorClass = [
  'banner-slot block overflow-hidden rounded-3xl border border-white/10 bg-white/5 p-3 text-center shadow-glow transition hover:-translate-y-1',
  className
]
  .filter(Boolean)
  .join(' ');
---
<a class={anchorClass} href={anchorHref} aria-label={banner.alt} data-placement={placement}>
  <img
    src={imgSrc}
    alt={banner.alt}
    width={banner.width}
    height={banner.height}
    loading="lazy"
    decoding="async"
    class="h-auto w-full object-cover"
  />
</a>
