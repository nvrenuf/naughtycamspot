---
import MainLayout from '../layouts/MainLayout.astro';
import SEO from '../components/SEO.astro';
import { PLATFORMS } from '../data/platforms';
import { isPagesBuild, withBase } from '../utils/links';
import { getRequestLang, t } from '../i18n/core';

const canonicalPath = '/platforms';
const lang = getRequestLang(Astro.url);
const resolveHostname = (value: string | undefined) => {
  if (!value) {
    return '';
  }
  try {
    return new URL(value).hostname;
  } catch {
    return String(value).replace(/^https?:\/\//, '').split('/')[0];
  }
};

const siteHostname = resolveHostname(import.meta.env.SITE as string | undefined);
const isProdSite = siteHostname === 'naughtycamspot.com';
const useGoLinks = !isPagesBuild() && isProdSite;
---

<MainLayout
  title="Platforms | NaughtyCamSpot"
  description="Signup Help (Free): supported platforms and tracked signup links."
>
  <SEO
    slot="head"
    title="Platforms | NaughtyCamSpot"
    description="Signup Help (Free): pick a platform and move to the next step."
    path={canonicalPath}
  />

  <section class="space-y-10">
    <div class="content-card space-y-4">
      <p class="hero-tagline">Signup Help (Free)</p>
      <h1 class="font-display text-4xl text-white sm:text-5xl">{t(lang, 'platforms.title')}</h1>
      <p class="max-w-2xl text-base text-white/70">
        This page is Signup Help (Free). Pick your platform and take the next step.
      </p>
      <div class="flex flex-col gap-3 sm:flex-row sm:items-center">
        <a
          class="inline-flex items-center justify-center rounded-full border border-rose-gold/70 bg-rose-gold px-6 py-3 text-sm uppercase tracking-[0.3em] text-midnight shadow-glow transition hover:-translate-y-1"
          href={withBase('/apply')}
        >
          {t(lang, 'platforms.cta')}
        </a>
        <a
          class="inline-flex items-center justify-center rounded-full border border-white/20 bg-transparent px-6 py-3 text-sm uppercase tracking-[0.3em] text-white transition hover:-translate-y-1 hover:border-white/40 hover:bg-white/5"
          href={withBase('/packages')}
        >
          Promotion (Paid)
        </a>
      </div>
    </div>

    <div class="grid gap-6 lg:grid-cols-2">
      {PLATFORMS.map((platform) => {
        const href = useGoLinks ? platform.goPath : withBase('/apply');
        const target = useGoLinks ? '_blank' : undefined;
        const rel = useGoLinks ? 'noopener noreferrer' : undefined;
        return (
          <article class="content-card space-y-4">
            <div class="flex items-center justify-between">
              <h2 class="font-display text-2xl text-white">{platform.name}</h2>
              <span class="rounded-full border border-white/10 px-3 py-1 text-[0.65rem] uppercase tracking-[0.28em] text-rose-petal/70">
                {platform.statusLabel}
              </span>
            </div>
            <p class="text-sm text-white/70">{platform.note}</p>
            <div>
              <a
                class="inline-flex items-center gap-2 text-xs uppercase tracking-[0.3em] text-rose-gold transition hover:text-white"
                href={href}
                target={target}
                rel={rel}
                data-platform={platform.slug}
                data-preclick={useGoLinks ? '1' : undefined}
                data-go-href={useGoLinks ? platform.goPath : undefined}
                data-platform-id={platform.slug}
                data-platform-name={platform.name}
              >
                View requirements
              </a>
            </div>
          </article>
        );
      })}
    </div>
  </section>
</MainLayout>
