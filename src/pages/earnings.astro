---
import LinkCTA from '../components/LinkCTA.astro';
import Notices from '../components/Notices.astro';
import MainLayout from '../layouts/MainLayout.astro';
import { PRIMARY_CTA } from '../data/copy';
import earnings from '../data/earnings.json';
import programs from '../data/programs.json';

interface Program {
  key: string;
  name: string;
  join_base: string;
  status: 'approved' | 'pending';
}

const formatDateStamp = () => {
  const now = new Date();
  const year = String(now.getUTCFullYear());
  const month = String(now.getUTCMonth() + 1).padStart(2, '0');
  const day = String(now.getUTCDate()).padStart(2, '0');
  return `${year}${month}${day}`;
};

const dateStamp = formatDateStamp();
const programIndex = new Map((programs as Program[]).map((program) => [program.key, program]));
const bandEntries = Object.entries(earnings.bands ?? {});
const formatter = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });
const bandLabels: Record<string, string> = {
  new: 'New creator lane',
  growing: 'Growing momentum',
  top25: 'Top 25%',
  top10: 'Top 10%'
};

const cards = bandEntries.map(([key, bands]) => {
  const program = programIndex.get(key);
  const joinHrefPages = program?.join_base ?? '';
  const joinHrefProdTemplate = `/go/model-join.php?src=earnings_${key}&camp=earnings&date=YYYYMMDD`;
  const joinHrefProd = joinHrefProdTemplate.replace('YYYYMMDD', dateStamp);
  const joinDisabled = !program || program.status !== 'approved' || !/^https?:\/\//i.test(joinHrefPages);

  return {
    key,
    name: program?.name ?? key,
    bands,
    joinHrefPages,
    joinHrefProd,
    joinDisabled
  };
});
---

<MainLayout title="Earnings benchmarks" description="Understand weekly earnings ranges for NaughtyCamSpot partner platforms.">
  <section class="space-y-8">
    <Notices />
    <div class="space-y-4">
      <h1 class="font-display text-4xl text-white sm:text-5xl">Earnings benchmarks for new creators</h1>
      <p class="max-w-3xl text-base text-white/70">
        These ranges are illustrative only. They help you calibrate the starter kit focus areas and conversations with our concierge team.
        Your actual earnings depend on how consistently you apply the levers below.
      </p>
    </div>
    <div class="grid gap-6 lg:grid-cols-3">
      {cards.map((card) => (
        <article class="flex h-full flex-col gap-5 rounded-[32px] border border-white/10 bg-white/5 p-6 backdrop-blur-2xl">
          <header class="space-y-1">
            <h2 class="font-display text-2xl text-white">{card.name}</h2>
            <p class="text-xs uppercase tracking-[0.35em] text-white/50">Illustrative ranges. No earnings guarantee.</p>
          </header>
          <div class="space-y-3 text-sm text-white/70">
            {Object.entries(card.bands).map(([bandKey, range]) => (
              <div class="rounded-2xl border border-white/10 bg-black/30 px-4 py-3">
                <p class="text-xs uppercase tracking-[0.35em] text-rose-petal/70">{bandLabels[bandKey] ?? bandKey}</p>
                <p class="mt-1 text-lg text-white">
                  {formatter.format(range[0])}â€“{formatter.format(range[1])} / week
                </p>
              </div>
            ))}
          </div>
          <footer class="mt-auto">
            <div class="flex flex-col gap-3 sm:flex-row">
              {card.joinDisabled ? (
                <span class="inline-flex items-center justify-center rounded-full border border-white/15 bg-white/5 px-6 py-3 text-xs uppercase tracking-[0.3em] text-white/40">
                  Join path pending
                </span>
              ) : (
                <LinkCTA
                  class="border border-rose-gold/60 bg-rose-gold text-midnight"
                  pagesHref={card.joinHrefPages}
                  prodHref={card.joinHrefProd}
                  label="Join with our links"
                />
              )}
              <LinkCTA
                class="border border-white/20 bg-transparent text-white hover:bg-white/10"
                pagesHref={PRIMARY_CTA.pagesHref}
                prodHref={PRIMARY_CTA.prodHref}
                label={PRIMARY_CTA.label}
              />
            </div>
          </footer>
        </article>
      ))}
    </div>
    <section class="space-y-4 rounded-[32px] border border-white/10 bg-white/5 p-6 backdrop-blur-2xl">
      <h2 class="font-display text-3xl text-white">What actually changes your outcome</h2>
      <ul class="grid gap-3 text-sm text-white/70 md:grid-cols-2">
        {earnings.levers.map((lever) => (
          <li class="flex items-center gap-3 rounded-2xl border border-white/10 bg-black/30 px-4 py-3">
            <span class="h-2 w-2 rounded-full bg-rose-gold"></span>
            <span class="uppercase tracking-[0.3em] text-white/70">{lever}</span>
          </li>
        ))}
      </ul>
    </section>
  </section>
</MainLayout>
