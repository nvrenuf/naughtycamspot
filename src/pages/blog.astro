---
import { getCollection } from 'astro:content';
import MainLayout from '../layouts/MainLayout.astro';
import { withBase } from '../utils/links';

const rawPosts = await getCollection('blog');
const posts = rawPosts
  .slice()
  .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime())
  .map((entry) => ({
    slug: entry.slug,
    title: entry.data.title,
    excerpt: entry.data.excerpt,
    category: entry.data.category,
    date: new Intl.DateTimeFormat('en-US', {
      month: 'long',
      day: '2-digit',
      year: 'numeric'
    }).format(entry.data.publishDate),
    image: entry.data.cardImage ?? entry.data.heroImage
  }));
---

<MainLayout
  title="Blog | NaughtyCamSpot"
  description="Insights & stories from the NaughtyCamSpot concierge team — luxury growth strategy for performers."
>
  <!-- SECTION: Blog Hero -->
  <section class="hero-shell parallax-veil">
    <div class="pointer-events-none absolute inset-0 bg-gradient-to-r from-black/50 via-transparent to-black/60"></div>
    <div class="relative space-y-6">
      <span class="hero-tagline">Editorial</span>
      <h1 class="font-display text-5xl leading-tight text-white sm:text-6xl">Insights &amp; Stories</h1>
      <p class="max-w-2xl text-base text-white/70">
        Field notes, success frameworks, and behind-the-scenes strategies from our concierge team. Sip something decadent and dig in.
      </p>
    </div>
  </section>

  <!-- SECTION: Blog Grid -->
  <section class="grid gap-6 sm:grid-cols-2">
    {posts.map((post, index) => (
      <article class="content-card group overflow-hidden" style={`animation-delay: ${index * 0.1}s`}>
        <div class="relative overflow-hidden rounded-3xl">
          <img src={post.image} alt={post.title} class="h-52 w-full object-cover" loading="lazy" />
          <div class="absolute inset-0 bg-gradient-to-t from-midnight via-transparent to-transparent opacity-80 transition group-hover:opacity-60"></div>
        </div>
        <div class="mt-6 space-y-3">
          <span class="text-xs uppercase tracking-[0.35em] text-rose-petal/70">{post.category}</span>
          <h2 class="font-display text-2xl text-white">{post.title}</h2>
          <p class="text-sm text-white/70">{post.excerpt}</p>
          <div class="flex items-center justify-between text-xs text-white/50">
            <span>{post.date}</span>
            <a
              class="uppercase tracking-[0.35em] text-rose-petal transition hover:text-rose-gold"
              href={withBase(`/blog/${post.slug}`)}
            >
              Read More ↗
            </a>
          </div>
        </div>
      </article>
    ))}
  </section>
</MainLayout>
