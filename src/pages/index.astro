---
import BannerSlot from '../components/BannerSlot.astro';
import MainLayout from '../layouts/MainLayout.astro';
import { buildTrackedLink, isPagesBuild, withBase } from '../utils/links';
import {
  BONGA_COUNTRY_TIERS,
  BONGA_TIER_ORDER,
  DEFAULT_TIER,
  MODEL_SIGNUP_PROGRAMS,
  getDefaultModelProgram
} from '../utils/model-rotator';

const HERO_CTA_PLACEHOLDER = 'https://linktr.ee/naughtycamspot';

const pagesBuild = isPagesBuild();
const modelProgram = getDefaultModelProgram();
const heroCtaSlot = 'home_hero';
const heroCtaCamp = 'home';
const heroCtaPath = modelProgram?.path ?? '/go/model-join.php';

const heroCtaHref = buildTrackedLink({
  path: heroCtaPath,
  slot: heroCtaSlot,
  camp: heroCtaCamp,
  placeholder: HERO_CTA_PLACEHOLDER
});

const safeStringify = (value: unknown) => JSON.stringify(value).replace(/</g, '\\u003c');
const modelRotatorPayload = safeStringify({
  programs: MODEL_SIGNUP_PROGRAMS,
  tierMap: BONGA_COUNTRY_TIERS,
  tierOrder: BONGA_TIER_ORDER,
  defaultTier: DEFAULT_TIER
});

const featuredMuseTiles = [
  {
    name: 'Anna Prince',
    slug: 'anna-prince',
    role: 'Stripchat • Velvet strategist',
    summary: 'Immersive bilingual storytelling, concierge-led room choreography, and luxe aftercare rituals.',
    href: '/models/anna-prince/',
    image: 'https://images.unsplash.com/photo-1517841905240-472988babdf9?auto=format&fit=crop&w=720&q=80'
  }
];

const featuredMuse = {
  name: 'Anna Prince',
  archetype: 'Stripchat • Velvet strategist',
  presence: 'Commanding presence blending intimate storytelling, bilingual charm, and precision-timed mod choreography.',
  image: 'https://images.unsplash.com/photo-1517841905240-472988babdf9?auto=format&fit=crop&w=960&q=80',
  quote:
    '“Every room they build feels like a gallery opening. My fans stay longer, tip deeper, and leave with a story to tell.”',
  story:
    'Anna anchors our concierge roster with luxe rituals, rotating set design, and segmented aftercare. From VIP salons to livestream premieres, she executes every beat with polish.',
  ctaHref: '/models/anna-prince'
};

const runwayBlueprint = [
  {
    title: 'Immersive Welcome Rituals',
    description:
      'Signature countdowns, playlist cues, and lighting shifts that frame your entrance like a premiere.'
  },
  {
    title: 'Conversion Choreography',
    description:
      'Layered goal pacing, mod-led prompts, and bespoke upsell ladders tuned to your comfort levels.'
  },
  {
    title: 'Aftercare & Retention',
    description:
      'Post-show debriefs, VIP touchpoints, and merch drops that keep your universe buzzing between sets.'
  }
];

const conciergeHighlights = [
  {
    title: 'Concierge Launch Architecture',
    description:
      'Signature onboarding rituals, boutique photography direction, and room-energy scripting tuned for luxury audiences.'
  },
  {
    title: 'Audience Chemistry Lab',
    description:
      'AI-assisted persona mapping, emotional cadence coaching, and nightly debriefs that turn lurkers into patrons.'
  },
  {
    title: 'Revenue Ecosystems',
    description:
      'Layered goal pacing, mod orchestration, and premium upsell frameworks that respect your boundaries and boost lifetime value.'
  }
];

const proofEntries = [
  {
    metric: 'Case Study A',
    summary: 'Premium room relaunch with concierge scripts and sonic cues.',
    source: 'Filed March 2025'
  },
  {
    metric: 'Case Study B',
    summary: 'Hybrid merch drop plus fan aftercare loop mapped over 6 weeks.',
    source: 'Audit pending April 2025'
  },
  {
    metric: 'Case Study C',
    summary: 'Multi-platform crossover using Spanish/English call-and-response.',
    source: 'Source: Internal concierge lab notes'
  }
];

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  name: 'NaughtyCamSpot',
  url: 'https://naughtycamspot.com',
  description:
    'Concierge-level growth agency for luxury cam models, delivering tailored launch architectures, retention choreography, and premium fan journeys.',
  sameAs: [
    'https://www.instagram.com/naughtycamspot',
    'https://twitter.com/naughtycamspot'
  ],
  contactPoint: {
    '@type': 'ContactPoint',
    contactType: 'Concierge support',
    email: 'concierge@naughtycamspot.com',
    areaServed: 'Global'
  }
};
---

<MainLayout
  title="NaughtyCamSpot | Luxury Model Gallery"
  description="Refined gallery experience for cam models who crave concierge-level support, rose-gold aesthetics, and growth you can feel."
>
  <script type="application/ld+json">{JSON.stringify(jsonLd)}</script>

  <!-- SECTION: Hero -->
  <section id="gallery-hero" class="glass relative overflow-hidden rounded-[42px] px-10 py-16">
      <div class="pointer-events-none absolute -left-24 top-12 h-48 w-48 rounded-full bg-rose-gold/40 blur-3xl"></div>
      <div class="pointer-events-none absolute -right-24 bottom-0 h-64 w-64 rounded-full bg-rose-gold/40 blur-[110px]"></div>
      <div class="relative grid gap-14 lg:grid-cols-[1.1fr_0.9fr]">
        <div class="space-y-8">
          <p class="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-5 py-2 text-xs uppercase tracking-[0.4em] text-rose-petal/80">
            Elevated model gallery
          </p>
          <h1 class="font-display text-5xl leading-tight text-white sm:text-6xl">
            The luxury runway<br />for models who own the night
          </h1>
          <p class="max-w-xl text-lg text-white/70">
            Curated aesthetics, glassy ambience, and concierge-level support. NaughtyCamSpot transforms your room into an
            immersive world that seduces premium fans and keeps them close.
          </p>
          <div class="flex flex-col gap-4 sm:flex-row">
            <a
              class="flex items-center justify-center rounded-full border border-rose-gold/60 bg-rose-gold px-6 py-3 text-sm font-semibold uppercase tracking-[0.2em] text-midnight shadow-glow transition hover:-translate-y-1"
              href={heroCtaHref}
              data-model-rotator="model-join"
              data-slot={heroCtaSlot}
              data-camp={heroCtaCamp}
              target="_blank"
              rel="noreferrer"
            >
              Become Our Next Muse
            </a>
            <a
              class="flex items-center justify-center rounded-full border border-white/15 bg-white/5 px-6 py-3 text-sm font-semibold uppercase tracking-[0.2em] text-white/80 backdrop-blur-xl transition hover:-translate-y-1"
              href="#concierge"
            >
              Explore the VIP Suite
            </a>
          </div>
        </div>
        <div class="relative flex items-center justify-center">
          <div class="absolute inset-0 animate-float rounded-[34px] border border-white/10 bg-gradient-to-br from-white/10 via-white/5 to-transparent"></div>
          <div class="relative glass h-full w-full max-w-sm rounded-[34px] p-8">
            <div class="flex flex-col gap-5">
              <p class="text-xs uppercase tracking-[0.45em] text-rose-petal/70">Proof in motion</p>
              <ul class="space-y-4 text-sm text-white/70">
                {proofEntries.map((entry) => (
                  <li class="rounded-3xl border border-white/10 bg-white/5 p-5">
                    <p class="font-display text-lg text-white">{entry.metric}</p>
                    <p class="mt-1 text-white/60">{entry.summary}</p>
                    <p class="mt-2 text-[0.65rem] uppercase tracking-[0.35em] text-white/40">{entry.source}</p>
                  </li>
                ))}
              </ul>
              <a class="text-xs uppercase tracking-[0.4em] text-rose-gold transition hover:text-white" href="#proof">
                See all proof ↓
              </a>
            </div>
          </div>
        </div>
      </div>
    </section>

  <!-- SECTION: Featured muse tiles -->
  <section aria-labelledby="featured-muses-heading" class="mt-14">
      <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div>
          <h2 id="featured-muses-heading" class="font-display text-3xl text-white sm:text-4xl">Featured muses</h2>
          <p class="mt-2 text-sm text-white/70">
            Spotlighting concierge muses you can study, book, or draw inspiration from for your own runway.
          </p>
        </div>
        <a class="text-xs uppercase tracking-[0.35em] text-rose-gold transition hover:text-white" href={withBase('/models')}>
          View gallery →
        </a>
      </div>
      <div class="mt-8 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {featuredMuseTiles.map((tile) => (
          <a
            class="glass group relative flex h-full flex-col justify-end overflow-hidden rounded-[32px] border border-white/10 bg-white/5 p-8 transition hover:-translate-y-2 hover:border-rose-gold/40"
            href={withBase(tile.href)}
            data-featured-muse={tile.slug}
          >
            <div
              class="pointer-events-none absolute inset-0 opacity-70 transition duration-500 group-hover:opacity-90"
              style={`background-image: url('${tile.image}'); background-size: cover; background-position: center;`}
            ></div>
            <div class="relative space-y-2">
              <span class="inline-flex items-center gap-2 rounded-full border border-white/15 bg-black/40 px-4 py-1 text-[0.65rem] uppercase tracking-[0.4em] text-rose-petal/70">
                Concierge muse
              </span>
              <h3 class="font-display text-2xl text-white">{tile.name}</h3>
              <p class="text-sm uppercase tracking-[0.3em] text-white/70">{tile.role}</p>
              <p class="text-sm text-white/70">{tile.summary}</p>
            </div>
          </a>
        ))}
      </div>
    </section>

  <!-- SLOT: home_top_leaderboard -->
  <BannerSlot id="home_top_leaderboard" class="mt-14" />

  <!-- SECTION: Concierge -->
  <section id="concierge" class="space-y-12">
      <div class="flex flex-col items-start justify-between gap-6 sm:flex-row sm:items-center">
        <div>
          <h2 class="font-display text-4xl text-white">Our concierge touch</h2>
          <p class="mt-3 max-w-2xl text-base text-white/70">
            We blend sensory storytelling, psychology-backed rituals, and data-guided coaching into a tailored program that feels
            as polished as your best performance night.
          </p>
        </div>
        <span class="rounded-full border border-white/10 bg-white/5 px-5 py-2 text-xs uppercase tracking-[0.4em] text-rose-petal/80">
          Signature services
        </span>
      </div>
      <div class="grid gap-6 md:grid-cols-3">
        {conciergeHighlights.map((item, index) => (
          <article
            class="glass relative overflow-hidden rounded-3xl p-8 transition duration-500 ease-out hover:-translate-y-2 hover:border-rose-gold/40"
            style={`animation-delay: ${index * 0.15}s`}
          >
            <div class="pointer-events-none absolute right-0 top-0 h-32 w-32 rounded-full bg-rose-gold/20 blur-3xl"></div>
            <h3 class="font-display text-2xl text-white">{item.title}</h3>
            <p class="mt-4 text-sm leading-relaxed text-white/70">{item.description}</p>
          </article>
        ))}
      </div>
    </section>

  <!-- SLOT: home_mid_rectangle -->
  <BannerSlot id="home_mid_rectangle" class="mt-16" />

  <!-- SECTION: Featured Muse -->
  <section id="muse-spotlight" class="glass overflow-hidden rounded-[42px] px-10 py-14">
      <div class="grid gap-10 lg:grid-cols-[1.1fr_0.9fr]">
        <div class="space-y-6">
          <span class="inline-flex w-fit items-center gap-2 rounded-full border border-white/10 bg-white/10 px-4 py-2 text-xs uppercase tracking-[0.4em] text-rose-petal/80">
            Featured muse
          </span>
          <div class="space-y-3">
            <h2 class="font-display text-4xl text-white sm:text-5xl">{featuredMuse.name}</h2>
            <p class="text-sm uppercase tracking-[0.3em] text-rose-petal/80">{featuredMuse.archetype}</p>
            <p class="max-w-xl text-base text-white/70">{featuredMuse.story}</p>
          </div>
          <div class="flex flex-col gap-4 sm:flex-row">
            <a
              class="flex items-center justify-center rounded-full border border-rose-gold/60 bg-rose-gold px-6 py-3 text-sm font-semibold uppercase tracking-[0.2em] text-midnight shadow-glow transition hover:-translate-y-1"
              href={withBase(featuredMuse.ctaHref)}
            >
              Meet {featuredMuse.name}
            </a>
            <a
              class="flex items-center justify-center rounded-full border border-white/15 bg-white/5 px-6 py-3 text-sm font-semibold uppercase tracking-[0.2em] text-white/80 backdrop-blur-xl transition hover:-translate-y-1"
              href={withBase('/models')}
            >
              Tour the full gallery
            </a>
          </div>
          <p class="text-sm text-white/55">{featuredMuse.quote}</p>
        </div>
        <div class="relative">
          <div class="pointer-events-none absolute -top-16 right-4 h-36 w-36 rounded-full bg-rose-gold/30 blur-3xl"></div>
          <div class="glass relative overflow-hidden rounded-[38px]">
            <img src={featuredMuse.image} alt={featuredMuse.name} class="h-full w-full object-cover" loading="lazy" />
          </div>
        </div>
      </div>
    </section>

  <!-- SECTION: Runway -->
  <section id="runway" class="space-y-12">
      <div class="flex flex-col items-start justify-between gap-6 sm:flex-row sm:items-center">
        <div>
          <h2 class="font-display text-4xl text-white">Your velvet runway</h2>
          <p class="mt-3 max-w-2xl text-base text-white/70">
            Every muse launches with a curated arc — from the first teaser ping to the final aftercare touchpoint. These are the pillars
            we drop into every suite to keep premium audiences invested.
          </p>
        </div>
        <span class="rounded-full border border-white/10 bg-white/5 px-5 py-2 text-xs uppercase tracking-[0.4em] text-rose-petal/80">
          Experience blueprint
        </span>
      </div>
      <div class="grid gap-6 md:grid-cols-3">
        {runwayBlueprint.map((item, index) => (
          <article
            class="glass relative overflow-hidden rounded-3xl p-8 transition duration-500 ease-out hover:-translate-y-2 hover:border-rose-gold/40"
            style={`animation-delay: ${index * 0.15}s`}
          >
            <div class="pointer-events-none absolute right-0 top-0 h-32 w-32 rounded-full bg-rose-gold/20 blur-3xl"></div>
            <h3 class="font-display text-2xl text-white">{item.title}</h3>
            <p class="mt-4 text-sm leading-relaxed text-white/70">{item.description}</p>
          </article>
        ))}
      </div>
    </section>

  <!-- SECTION: Proof -->
  <section id="proof" class="glass overflow-hidden rounded-[42px] px-10 py-14">
      <div class="flex flex-col gap-8 lg:flex-row lg:items-center lg:justify-between">
        <div class="max-w-xl space-y-4">
          <h2 class="font-display text-4xl text-white">Proof of concept</h2>
          <p class="text-base text-white/70">
            We track every launch with concierge notes, mod call transcripts, and conversion snapshots. Real case files sit ready for
            partners under NDA; this block marks where the receipts will live.
          </p>
        </div>
        <a class="rounded-full border border-white/20 bg-white/5 px-5 py-3 text-xs uppercase tracking-[0.4em] text-rose-petal/80 backdrop-blur-xl transition hover:text-rose-gold" href={withBase('/case-studies')}>
          See details shortly
        </a>
      </div>
      <div class="grid gap-6 md:grid-cols-3">
        {proofEntries.map((entry, index) => (
          <article class="glass space-y-3 rounded-3xl border border-white/10 bg-white/5 p-6" style={`animation-delay: ${index * 0.12}s`}>
            <p class="text-xs uppercase tracking-[0.4em] text-rose-petal/70">{entry.source}</p>
            <h3 class="font-display text-2xl text-white">{entry.metric}</h3>
            <p class="text-sm text-white/65">{entry.summary}</p>
          </article>
        ))}
      </div>
    </section>

  <!-- SECTION: Retention -->
  <section id="retention" class="glass overflow-hidden rounded-[42px] px-10 py-14">
      <div class="grid gap-10 lg:grid-cols-[1.1fr_0.9fr]">
        <div class="space-y-6">
          <h2 class="font-display text-4xl text-white">Why models stay</h2>
          <p class="text-base text-white/70">
            Ultra-tailored coaching rhythms, discreet data insights, and brand support that celebrates your edges instead of smoothing
            them out. You bring the essence, we sculpt the experience.
          </p>
          <ul class="grid gap-4 text-sm text-white/70 sm:grid-cols-2">
            <li class="rounded-2xl border border-white/10 bg-white/5 px-5 py-4 backdrop-blur-xl">Bespoke onboarding rituals</li>
            <li class="rounded-2xl border border-white/10 bg-white/5 px-5 py-4 backdrop-blur-xl">Psych-backed mod choreography</li>
            <li class="rounded-2xl border border-white/10 bg-white/5 px-5 py-4 backdrop-blur-xl">Signature show moodboards</li>
            <li class="rounded-2xl border border-white/10 bg-white/5 px-5 py-4 backdrop-blur-xl">VIP retention funnels</li>
          </ul>
        </div>
        <div class="relative">
          <div class="pointer-events-none absolute -top-10 left-1/2 h-36 w-36 -translate-x-1/2 rounded-full bg-rose-gold/30 blur-3xl"></div>
          <div class="glass relative overflow-hidden rounded-3xl p-8">
            <span class="text-xs uppercase tracking-[0.4em] text-rose-petal/80">Voices from the suite</span>
            <p class="mt-6 font-display text-2xl text-white">
              “I doubled my average tip train in two weekends. The room choreography and vibe coaching feel like having an artistic
              director in my ear without losing my freedom.”
            </p>
            <p class="mt-6 text-sm text-white/60">— Mila, VIP Muse</p>
          </div>
        </div>
      </div>
    </section>

  <!-- SLOT: home_footer_leaderboard -->
  <BannerSlot id="home_footer_leaderboard" class="mt-16" />

  {!pagesBuild && (
    <script is:inline type="module">
      const payload = JSON.parse('{modelRotatorPayload}');
      const { programs, tierMap, tierOrder, defaultTier } = payload;

      const formatDateStamp = () => {
        const now = new Date();
        const year = String(now.getUTCFullYear());
        const month = String(now.getUTCMonth() + 1).padStart(2, '0');
        const day = String(now.getUTCDate()).padStart(2, '0');
        return `${year}${month}${day}`;
      };

      const buildTrackedHref = (path, slot, camp) => {
        if (!path) return undefined;
        const normalizedPath = path.startsWith('/') ? path : `/${path}`;
        const glue = normalizedPath.includes('?') ? '&' : '?';
        const date = formatDateStamp();
        return `${normalizedPath}${glue}src=${encodeURIComponent(slot)}&camp=${encodeURIComponent(camp)}&date=${date}`;
      };

      const parseLocaleToCountry = (locale) => {
        if (!locale || typeof locale !== 'string') return undefined;
        const match = locale.toUpperCase().match(/[-_]([A-Z]{2})$/);
        return match ? match[1] : undefined;
      };

      const collectLocales = () => {
        const locales = new Set();
        if (Array.isArray(navigator.languages)) {
          navigator.languages.forEach((lang) => locales.add(lang));
        }

        if (navigator.language) {
          locales.add(navigator.language);
        }

        try {
          const resolved = Intl.DateTimeFormat().resolvedOptions().locale;
          if (resolved) {
            locales.add(resolved);
          }
        } catch (error) {
          // ignore
        }

        return Array.from(locales);
      };

      const findProgramForTier = (tier) => {
        const activePrograms = programs.filter((program) => program.active !== false);
        if (activePrograms.length === 0) {
          return undefined;
        }

        const startingIndex = Math.max(tierOrder.indexOf(tier), 0);
        for (let index = startingIndex; index < tierOrder.length; index += 1) {
          const currentTier = tierOrder[index];
          const match = activePrograms.find((program) =>
            Array.isArray(program.tiers) && program.tiers.includes(currentTier)
          );

          if (match) {
            return match;
          }
        }

        return activePrograms[0];
      };

      const detectCountry = () => {
        const locales = collectLocales();
        for (const locale of locales) {
          const country = parseLocaleToCountry(locale);
          if (country) {
            return country;
          }
        }

        return undefined;
      };

      const applyRotator = () => {
        const anchors = document.querySelectorAll('[data-model-rotator="model-join"]');
        if (!anchors.length) {
          return;
        }

        const country = detectCountry();
        const tier = (country && tierMap[country]) || defaultTier;
        const program = findProgramForTier(tier);

        if (!program) {
          return;
        }

        anchors.forEach((anchor) => {
          const slot = anchor.dataset.slot;
          const camp = anchor.dataset.camp;
          if (!slot || !camp) {
            return;
          }

          const href = buildTrackedHref(program.path, slot, camp);
          if (href) {
            anchor.href = href;
          }
        });
      };

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', applyRotator, { once: true });
      } else {
        applyRotator();
      }
    </script>
  )}
</MainLayout>
