---
import MainLayout from '../layouts/MainLayout.astro';
import { withBase } from '../utils/links';
import { getCollection } from 'astro:content';

const categories = ['Lighting', 'Conversion', 'Scheduling', 'Aftercare'];

const modelEntries = await getCollection('models');

const library = modelEntries.map((entry) => ({
  name: entry.data.name,
  slug: entry.id,
  summary: entry.data.summary,
  image: entry.data.cardImage ?? entry.data.heroImage,
  featured: entry.data.featured,
  featuredOrder: entry.data.featuredOrder ?? Number.POSITIVE_INFINITY,
  consent: entry.data.consent === true
}));

const featuredModels = library
  .filter((entry) => entry.featured)
  .sort((a, b) => {
    if (a.featuredOrder === b.featuredOrder) {
      return a.slug.localeCompare(b.slug);
    }

    return a.featuredOrder - b.featuredOrder;
  });

const libraryModels = library
  .filter((entry) => !entry.featured)
  .sort((a, b) => a.name.localeCompare(b.name));
---

<MainLayout
  title="Example Models | NaughtyCamSpot"
  description="Explore example cam model pages that demonstrate how to use the NaughtyCamSpot StartRight kit templates."
>
  <!-- SECTION: Models Hero -->
  <section class="hero-shell parallax-veil">
    <div class="pointer-events-none absolute inset-0 bg-gradient-to-br from-white/10 via-transparent to-black/50"></div>
    <div class="relative space-y-6">
      <span class="hero-tagline">Example Library</span>
      <h1 class="font-display text-5xl leading-tight text-white sm:text-6xl">Example model walkthroughs</h1>
      <p class="max-w-2xl text-base text-white/70">
        These pages are demos, not promotions. Each example highlights how to apply the StartRight kit’s lighting notes, schedule, and
        conversion ladders. Use them as inspiration while keeping full control of your own accounts.
      </p>
    </div>
  </section>

  <!-- SECTION: Models Grid -->
  <section class="space-y-10">
    <div class="flex flex-wrap items-center gap-3 rounded-full border border-white/10 bg-white/5 px-4 py-2 text-[0.75rem] uppercase tracking-[0.35em] text-rose-petal/80 backdrop-blur-xl">
      {categories.map((category) => (
        <button
          class="rounded-full border border-transparent bg-transparent px-4 py-2 text-white/70 transition hover:border-rose-gold/40 hover:text-rose-gold"
          type="button"
        >
          {category}
        </button>
      ))}
    </div>

    <div class="grid gap-6 sm:grid-cols-2 xl:grid-cols-3">
      {featuredModels.map((model, index) => (
        <article
          class="group content-card overflow-hidden"
          style={`animation-delay: ${index * 0.1}s`}
        >
          <div class="relative overflow-hidden rounded-3xl">
            <img
              src={model.image}
              alt={model.name}
              loading="lazy"
              class="h-64 w-full object-cover opacity-90 transition duration-700 ease-out group-hover:scale-105 group-hover:opacity-100"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-midnight via-transparent to-transparent opacity-70 transition group-hover:opacity-50"></div>
          </div>
          <div class="mt-6 space-y-3">
            <h2 class="font-display text-2xl text-white">{model.name}</h2>
            <p class="text-sm text-white/70">{model.summary}</p>
            <a
              class="inline-flex items-center gap-2 text-xs uppercase tracking-[0.35em] text-rose-petal transition hover:text-rose-gold"
              data-model={model.slug}
              href={withBase(`/models/${model.slug}`)}
            >
              View example ↗
            </a>
          </div>
        </article>
      ))}
    </div>
  </section>

  {libraryModels.length > 0 && (
    <section class="space-y-8">
      <div class="space-y-3">
        <h2 class="section-heading">Library previews</h2>
        <p class="max-w-2xl text-sm text-white/60">
          These additional walkthroughs are staged examples. Full visuals unlock once each creator opts in.
        </p>
      </div>

      <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {libraryModels.map((model, index) => (
          <article
            class="group content-card overflow-hidden"
            style={`animation-delay: ${index * 0.08}s`}
          >
            <div class="relative overflow-hidden rounded-3xl">
              <img
                src={model.image}
                alt={model.name}
                loading="lazy"
                class={`h-60 w-full object-cover transition duration-700 ease-out group-hover:scale-105 ${
                  model.consent ? 'opacity-90 group-hover:opacity-100' : 'opacity-40 group-hover:opacity-60'
                }`}
              />
              {!model.consent && (
                <div class="absolute inset-0 bg-gradient-to-t from-midnight via-black/40 to-transparent"></div>
              )}
            </div>
            <div class="mt-6 space-y-3">
              <h3 class="font-display text-xl text-white">{model.name}</h3>
              <p class="text-sm text-white/65">{model.summary}</p>
              <p class="text-xs uppercase tracking-[0.35em] text-white/45">
                {model.consent ? 'Example ready' : 'Consent pending listing'}
              </p>
              <a
                class="inline-flex items-center gap-2 text-xs uppercase tracking-[0.35em] text-rose-petal transition hover:text-rose-gold"
                data-model={model.slug}
                href={withBase(`/models/${model.slug}`)}
              >
                {model.consent ? 'View example ↗' : 'View listing ↗'}
              </a>
            </div>
          </article>
        ))}
      </div>
    </section>
  )}
</MainLayout>
