---
import programs from '../../data/programs.json';
import { withBase } from '../../utils/links';

interface Program {
  key: string;
  name: string;
  payout: string;
  traffic: string;
  best_for: string[];
  status: string;
}

const formatStatus = (status: string) =>
  status
    .split('_')
    .map((token) => (token ? token[0]?.toUpperCase() + token.slice(1) : token))
    .join(' ');

const curatedPrograms = (programs as Program[])
  .filter((program) => !['blocked', 'research'].includes(program.status))
  .slice(0, 4)
  .map((program) => ({
    ...program,
    statusLabel: formatStatus(program.status)
  }));
---
<section class="border-t border-white/5 bg-midnight/40 px-6 py-20">
  <div class="mx-auto flex max-w-6xl flex-col gap-12">
    <div class="flex flex-col gap-5 sm:flex-row sm:items-end sm:justify-between">
      <div class="max-w-2xl space-y-3">
        <p class="text-[clamp(0.75rem,1.2vw,0.9rem)] uppercase tracking-[0.4em] text-rose-petal/70">
          Trusted programs
        </p>
        <h2 class="font-display text-[clamp(2rem,4vw,2.8rem)] leading-snug text-white">
          Platforms we actively launch on
        </h2>
        <p class="text-[clamp(0.95rem,1.8vw,1.1rem)] text-white/70">
          We only recommend programs with responsive partner teams, reliable payouts, and concierge access so you can escalate
          questions within hours.
        </p>
      </div>
      <a class="text-[clamp(0.78rem,1.4vw,0.9rem)] uppercase tracking-[0.35em] text-rose-gold transition hover:text-white" href={withBase('/compare')}>
        Compare all programs
      </a>
    </div>
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
      {curatedPrograms.map((program) => (
        <article class="flex h-full flex-col gap-4 rounded-3xl border border-white/10 bg-white/5 p-6">
          <div>
            <p class="text-[clamp(0.8rem,1.4vw,0.9rem)] uppercase tracking-[0.35em] text-rose-petal/70">{program.statusLabel}</p>
            <h3 class="font-display text-[clamp(1.35rem,3vw,1.8rem)] text-white">{program.name}</h3>
          </div>
          <ul class="space-y-2 text-[clamp(0.9rem,1.6vw,1.05rem)] text-white/75">
            <li><span class="text-white/50">Payout:</span> {program.payout}</li>
            <li><span class="text-white/50">Traffic:</span> {program.traffic}</li>
            <li>
              <span class="text-white/50">Best for:</span>
              {' '}
              {program.best_for.join(', ')}
            </li>
          </ul>
          <a class="mt-auto inline-flex text-[clamp(0.78rem,1.4vw,0.9rem)] uppercase tracking-[0.35em] text-rose-gold transition hover:text-white" href={withBase(`/compare#${program.key}`)}>
            Review concierge notes
          </a>
        </article>
      ))}
    </div>
  </div>
</section>
