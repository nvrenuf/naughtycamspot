---
const {
  title = 'NaughtyCamSpot',
  description = 'NaughtyCamSpot -- concierge growth for ambitious cam models.',
  showNavigation = true
} = Astro.props;
import '../styles/tailwind.css';
import { buildTrackedLink, withBase } from '../utils/links';

const isPagesBuild = import.meta.env.IS_PAGES === 'true';

const resolveHostname = (value) => {
  if (!value) {
    return '';
  }

  try {
    return new URL(value).hostname;
  } catch {
    return String(value).replace(/^https?:\/\//, '').split('/')[0];
  }
};

const siteHostname = resolveHostname(import.meta.env.SITE ?? '');
const isProdSite = siteHostname === 'naughtycamspot.com';
const shouldTrackClicks = isProdSite && !isPagesBuild;
const gaMeasurementId =
  typeof import.meta.env.PUBLIC_GA4_ID === 'string'
    ? import.meta.env.PUBLIC_GA4_ID.trim()
    : '';
const shouldLoadAnalytics = shouldTrackClicks && gaMeasurementId.length > 0;
const organizationJsonLd = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  name: 'NaughtyCamSpot',
  url: import.meta.env.SITE ?? 'https://naughtycamspot.com'
};

const HERO_CTA_PLACEHOLDER = 'https://linktr.ee/naughtycamspot';
const navCtaSlot = 'nav_cta';
const navCtaCamp = 'site_nav';

const navCtaHref = buildTrackedLink({
  path: '/go/model-join.php',
  slot: navCtaSlot,
  camp: navCtaCamp,
  placeholder: HERO_CTA_PLACEHOLDER
});

const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/compare', label: 'Compare' },
  { href: '/recommend', label: 'Recommend' },
  { href: '/earnings', label: 'Earnings' },
  { href: '/contests', label: 'Contests' },
  { href: '/starter-kit', label: 'Starter Kit' },
  { href: '/join', label: 'Join' },
  { href: '/blog', label: 'Blog' },
  { href: '/about', label: 'About' },
  { href: '/contact', label: 'Contact' },
  { href: '/models/anna-prince', label: 'Example model page' }
];

const footerLinks = [
  { href: '/privacy', label: 'Privacy Policy' },
  { href: '/terms', label: 'Terms' },
  { href: '/disclosure', label: 'Affiliate Disclosure' }
];

const mainTopPadding = showNavigation ? 'pt-10' : 'pt-20';
---
<!doctype html>
<html lang="en" class="bg-midnight">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <base href={import.meta.env.BASE_URL} />
    <slot name="head">
      <title>{title}</title>
      <meta name="description" content={description} />
    </slot>
    {isPagesBuild && <meta name="robots" content="noindex,nofollow" />}
  <script type="application/ld+json" set:html={JSON.stringify(organizationJsonLd)} />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet" />
    {shouldLoadAnalytics && (
      <>
        <script async src={`https://www.googletagmanager.com/gtag/js?id=${gaMeasurementId}`}></script>
        <script is:inline>
          {`window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '${gaMeasurementId}');`}
        </script>
      </>
    )}
  </head>
  <body class="relative min-h-screen overflow-x-hidden bg-midnight text-white">
    <div class="pointer-events-none fixed inset-0 z-0 bg-aurora opacity-80"></div>
    <div class="pointer-events-none absolute -left-24 top-32 h-72 w-72 rounded-full bg-rose-gold/20 blur-3xl"></div>
    <div class="pointer-events-none absolute -right-32 top-12 h-80 w-80 rounded-full bg-rose-gold/25 blur-3xl"></div>

    <div class="relative z-10 flex min-h-screen flex-col">
      {showNavigation && (
        <header class="mx-auto flex w-full max-w-6xl flex-col gap-5 px-6 pt-10 lg:flex-row lg:items-center lg:justify-between lg:gap-6">
          <div class="flex w-full items-center justify-between gap-3">
            <a
              href={withBase('/')}
              class="flex items-center gap-3 text-sm font-semibold tracking-[0.32em] text-rose-gold uppercase"
            >
              <span class="flex h-11 w-11 items-center justify-center rounded-full border border-rose-gold/60 bg-white/10 shadow-glow backdrop-blur-lg">
                N
              </span>
              NaughtyCamSpot
            </a>
            <a
              class="rounded-full border border-rose-gold/40 bg-rose-gold/20 px-5 py-2 text-xs font-semibold uppercase tracking-[0.3em] text-rose-petal shadow-glow backdrop-blur-xl transition hover:border-rose-gold/60 hover:bg-rose-gold/30"
              href={navCtaHref}
              target="_blank"
              rel="noreferrer"
              data-track={shouldTrackClicks ? 'click' : undefined}
              data-slot={shouldTrackClicks ? navCtaSlot : undefined}
              data-camp={shouldTrackClicks ? navCtaCamp : undefined}
            >
              Start camming • Free starter kit
            </a>
          </div>
          <nav class="flex w-full flex-wrap items-center justify-center gap-3 rounded-full border border-white/10 bg-white/10 px-4 py-3 text-[0.65rem] uppercase tracking-[0.25em] text-white/70 backdrop-blur-2xl sm:gap-4 sm:text-[0.7rem] sm:tracking-[0.28em] lg:flex-nowrap lg:text-sm lg:tracking-[0.3em]">
            {navLinks.map((link) => (
              <a class="whitespace-nowrap transition hover:text-rose-gold" href={withBase(link.href)}>
                {link.label}
              </a>
            ))}
          </nav>
        </header>
      )}

      <main class={`relative mx-auto flex w-full max-w-6xl flex-1 flex-col gap-24 px-6 pb-24 ${mainTopPadding}`}>
        <slot />
      </main>

      <footer class="border-t border-white/10 bg-black/40 py-10 backdrop-blur-2xl">
        <div class="mx-auto flex w-full max-w-6xl flex-col gap-3 px-6 text-xs uppercase tracking-[0.4em] text-white/45 sm:flex-row sm:items-center sm:justify-between">
          <div class="flex flex-wrap items-center gap-4 text-[0.7rem]">
            {footerLinks.map((link) => (
              <a class="transition hover:text-rose-gold" href={withBase(link.href)}>
                {link.label}
              </a>
            ))}
          </div>
          <div class="flex items-center gap-4 text-[0.7rem]">
            <a class="transition hover:text-rose-gold" href="mailto:concierge@naughtycamspot.com">
              concierge@naughtycamspot.com
            </a>
            <span>© NaughtyCamSpot 2025</span>
          </div>
        </div>
      </footer>
    </div>
    {shouldTrackClicks && (
      <script is:inline>
        {`(function(){
  const endpoint = '/go/click.php';
  const sendBeacon = (slot, camp) => {
    const params = new URLSearchParams({
      e: 'click',
      src: slot || 'unknown',
      camp: camp || 'unknown',
      t: String(Date.now())
    });
    const url = endpoint + '?' + params.toString();
    if (navigator.sendBeacon) {
      navigator.sendBeacon(url);
      return;
    }
    try {
      fetch(url, { method: 'GET', mode: 'no-cors', keepalive: true });
    } catch (_) {
      // Swallow network errors — analytics should never block navigation.
    }
  };

  document.addEventListener('click', (event) => {
    const target = event.target instanceof Element ? event.target.closest('[data-track="click"]') : null;
    if (!target) {
      return;
    }

    const slot = target.getAttribute('data-slot') || '';
    const camp = target.getAttribute('data-camp') || '';
    sendBeacon(slot, camp);
  }, { capture: true });
})();`}
      </script>
    )}
  </body>
</html>
